---
title: Self-Hosting
description: Deploy ocrbase on your own infrastructure.
---

## Requirements

- **Bun** 1.3.9+
- **PostgreSQL** 15+
- **Redis** 7+
- **S3-compatible storage** (MinIO, AWS S3, etc.)
- **PaddleOCR-VL** service (GPU recommended)

## Environment variables

Create a `.env` file with the following configuration:

### Core

```bash
NODE_ENV=production
PORT=3000
HOST=0.0.0.0
```

### Database

```bash
DATABASE_URL=postgresql://user:password@localhost:5432/ocrbase
```

### Authentication

```bash
BETTER_AUTH_SECRET=your-secret-at-least-32-characters
BETTER_AUTH_URL=https://your-domain.com
CORS_ORIGINS=https://your-domain.com
```

### Redis

```bash
REDIS_URL=redis://localhost:6379
```

### Storage

```bash
S3_ENDPOINT=http://localhost:9000
S3_REGION=us-east-1
S3_BUCKET=ocrbase
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
```

### OCR service

```bash
PADDLE_OCR_URL=http://localhost:8080
PADDLEOCR_VL_API_KEY=local
PADDLE_OCR_TIMEOUT_MS=900000
PADDLE_OCR_MAX_RETRIES=1
```

### LLM (required for extraction)

```bash
OPENROUTER_API_KEY=sk_or_your_key
```

### GitHub OAuth (optional)

```bash
GITHUB_CLIENT_ID=your_client_id
GITHUB_CLIENT_SECRET=your_client_secret
```

### Worker tuning

```bash
# Concurrent jobs per worker (default: 5)
# Lower for large PDFs to avoid overloading the OCR service
WORKER_CONCURRENCY=5
# Queue retries and backoff between attempts
QUEUE_JOB_ATTEMPTS=3
QUEUE_BACKOFF_DELAY_MS=5000
```

## Setup

### 1. Clone and install

```bash
git clone https://github.com/your-org/ocrbase.git
cd ocrbase
bun install
```

### 2. Run database migrations

```bash
bun db:migrate
```

### 3. Build

```bash
bun run build
```

### 4. Start

```bash
bun start
```

The server starts on the configured `PORT` (default 3000).

## Architecture

```
                    ┌──────────┐
  Clients ────────► │  Server  │ ──────► PostgreSQL
                    │ (Elysia) │ ──────► Redis
                    └────┬─────┘ ──────► S3/MinIO
                         │
                    ┌────▼─────┐
                    │  Worker  │ ──────► PaddleOCR-VL
                    │ (BullMQ) │ ──────► LLM (OpenRouter)
                    └──────────┘
```

- **Server** — Handles API requests, creates jobs, serves WebSocket connections.
- **Worker** — Processes jobs from the BullMQ queue: OCR via PaddleOCR-VL, extraction via LLM.
- **PostgreSQL** — Stores jobs, schemas, API keys, and user data.
- **Redis** — Powers the BullMQ job queue and real-time WebSocket pub/sub.
- **S3/MinIO** — Stores uploaded documents.

## Health checks

Use the health endpoints for orchestration:

```bash
# Liveness — always returns 200
curl http://localhost:3000/v1/health/live

# Readiness — checks all dependencies
curl http://localhost:3000/v1/health/ready
```

The readiness endpoint returns `healthy`, `degraded`, or `unhealthy` based on the status of PostgreSQL, Redis, S3, and the OCR service.

## Job queue

Jobs are processed asynchronously via BullMQ with:

- **3 retry attempts** with exponential backoff
- **Completed jobs** kept for 24 hours (max 1000)
- **Failed jobs** kept for 7 days

Adjust `WORKER_CONCURRENCY` based on your OCR service capacity. For GPU-constrained setups, use `1-2`.
